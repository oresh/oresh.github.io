document.addEventListener("touchstart", function (e) {
    e.preventDefault();
}, { passive: false });
import * as palette from "./pallete";
import * as utils from "./utils";
import image_array from "./color_matrix";
var image = image_array;
var image_height = image.length;
var image_width = image[0].length;
var global = {
    window_width: 0,
    window_height: 0,
    active_color: "ffffff",
    image_scale: 1,
    square_size: 10,
    imageOffset: { x: 0, y: 0 },
    scaled_square_size: 0,
    palette_sorted: []
};
global.window_width = window.innerWidth;
global.window_height = window.innerHeight;
global.square_size = utils.calculateInitialSquareSize({
    "window_width": global.window_width,
    "window_height": global.window_height,
    image_width: image_width,
    image_height: image_height
});
global.imageOffset = utils.calculateOffset({
    "image_scale": global.image_scale,
    "square_size": global.square_size,
    "window_width": global.window_width,
    "window_height": global.window_height,
    image_width: image_width,
    image_height: image_height
});
global.scaled_square_size = global.image_scale * global.square_size;
global.palette_colors = palette.getColorPalette(image, image_width, image_height);
global.palette_sorted = palette.getPaletteOrder(global.palette_colors);
var stage = new Konva.Stage({
    container: 'main',
    width: global.window_width,
    height: global.window_height,
});
function handleSquarePress(groupEvt) {
    var target = groupEvt.currentTarget;
    var square = target.find('Rect')[0];
    if (square.attrs.isFilled === true)
        return;
    var active_color = global.active_color;
    var fillColor = square.attrs.fillColor;
    if (fillColor != active_color)
        return;
    square.setAttr("fill", "#" + fillColor);
    square.setAttr("strokeWidth", 0);
    square.setAttr("isFilled", true);
    global.palette_colors[fillColor].qty -= 1;
    if (global.palette_colors[fillColor].qty == 0)
        exhaustColor(fillColor);
    var text = target.find('Text');
    if (text[0])
        text[0].destroy();
}
function highlightSquaresMatchingColor(selectedColor) {
    var squares = global.canvas_layer.find('Rect');
    for (var i = 0; i < squares.length; i++) {
        var square = squares[i];
        if (square.attrs.isFilled === true)
            continue;
        if (square.attrs.fillColor == selectedColor) {
            square.setAttr("fill", "#d0d0d0");
        }
        else {
            square.setAttr("fill", "#f0f0f0");
        }
    }
}
function addSquareGroup(x, y, color) {
    if (color == "000000")
        return null;
    var square_size = global.square_size * global.image_scale;
    var group = new Konva.Group({
        x: x,
        y: y,
    });
    var rect = new Konva.Rect({
        width: square_size,
        height: square_size,
        greayColor: utils.getGreyFromColor('#' + color),
        fillColor: color,
        isFilled: false,
        fill: "#f0f0f0",
        stroke: "#d0d0d0",
        strokeWidth: 1,
    });
    var text = new Konva.Text({
        x: 0,
        y: (square_size - 14) / 2,
        align: 'center',
        width: square_size,
        text: global.palette_colors[color].order + 1,
        fontSize: 14,
        fontFamily: 'Arial',
        fill: "#888888"
    });
    group.on('click', handleSquarePress);
    group.on('touchstart', handleSquarePress);
    group.add(rect);
    group.add(text);
    return group;
}
global.canvas_layer = new Konva.Layer({
    width: global.window_width,
    height: global.window_height - 80,
    draggable: true,
});
stage.add(global.canvas_layer);
for (var i = 0; i < image_height; i++) {
    for (var j = 0; j < image_width; j++) {
        var x = i * global.scaled_square_size + global.imageOffset.x;
        var y = j * global.scaled_square_size + global.imageOffset.y;
        var unfilled_square = addSquareGroup(x, y, image[i][j]);
        if (unfilled_square !== null)
            global.canvas_layer.add(unfilled_square);
    }
}
function getDistance(p1, p2) {
    return Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));
}
function getCenter(p1, p2) {
    return {
        x: (p1.x + p2.x) / 2,
        y: (p1.y + p2.y) / 2,
    };
}
var lastCenter = null;
var lastDist = 0;
global.canvas_layer.on('touchmove', function (e) {
    e.evt.preventDefault();
    var touch1 = e.evt.touches[0];
    var touch2 = e.evt.touches[1];
    if (touch1 && touch2) {
        if (stage.isDragging()) {
            stage.stopDrag();
        }
        var p1 = {
            x: touch1.clientX,
            y: touch1.clientY,
        };
        var p2 = {
            x: touch2.clientX,
            y: touch2.clientY,
        };
        if (!lastCenter) {
            lastCenter = getCenter(p1, p2);
            return;
        }
        var newCenter = getCenter(p1, p2);
        var dist = getDistance(p1, p2);
        if (!lastDist) {
            lastDist = dist;
        }
        var pointTo = {
            x: (newCenter.x - stage.x()) / stage.scaleX(),
            y: (newCenter.y - stage.y()) / stage.scaleX(),
        };
        var scale = stage.scaleX() * (dist / lastDist);
        stage.scaleX(scale);
        stage.scaleY(scale);
        var dx = newCenter.x - lastCenter.x;
        var dy = newCenter.y - lastCenter.y;
        var newPos = {
            x: newCenter.x - pointTo.x * scale + dx,
            y: newCenter.y - pointTo.y * scale + dy,
        };
        stage.position(newPos);
        lastDist = dist;
        lastCenter = newCenter;
    }
});
global.canvas_layer.on('touchend', function () {
    lastDist = 0;
    lastCenter = null;
});
function resetColorPalette(selectedColor) {
    var layer = global.palette_layer;
    var all_color_groups = layer.find('Group');
    for (var i = 0; i < all_color_groups.length; i++) {
        var group = all_color_groups[i];
        if (group.attrs.color == selectedColor)
            continue;
        group.fire('reset');
    }
}
function findNextUnfilledColor(color) {
    var colors = global.palette_sorted;
    var index = colors.indexOf(color);
    var selectcolor = '';
    if (index == -1) {
        console.log('Can not find the active color!');
        return;
    }
    for (var i = index + 1; i < colors.length; i++) {
        var findcolor = colors[i];
        if (global.palette_colors[findcolor].completed == true)
            continue;
        selectcolor = findcolor;
        break;
    }
    if (selectcolor == '') {
        for (var i = 0; i < index; i++) {
            var findcolor = colors[i];
            if (global.palette_colors[findcolor].completed == true)
                continue;
            selectcolor = findcolor;
            break;
        }
    }
    if (selectcolor == '') {
        console.log("image completed");
        return;
    }
    return global.palette_layer.find('#' + selectcolor)[0];
}
function exhaustColor(fillColor) {
    console.log('color exhausted');
    var exhaustedColor = global.palette_layer.find('#' + fillColor)[0];
    exhaustedColor.completed = true;
    global.palette_colors[fillColor].completed = true;
    exhaustedColor.find('Circle')[0].opacity(0.4);
    var nextColor = findNextUnfilledColor(fillColor);
    nextColor.fire('click');
}
function triggerColorChange(groupEvt) {
    var target = groupEvt.currentTarget;
    var selectedColor = target.attrs.color;
    if (global.active_color == selectedColor)
        return;
    global.active_color = selectedColor;
    var circle = target.find('Circle')[0];
    circle.setAttr("strokeWidth", 3);
    highlightSquaresMatchingColor(selectedColor);
    resetColorPalette(selectedColor);
}
function resetActiveColor(groupEvt) {
    var target = groupEvt.currentTarget;
    var circle = target.find('Circle')[0];
    circle.setAttr("strokeWidth", 0);
}
var pallete_height = 70;
global.palette_layer = new Konva.Layer({
    draggable: true,
    width: global.window_width,
    height: pallete_height,
    y: global.window_height - pallete_height,
    dragBoundFunc: function (pos) {
        return {
            x: pos.x,
            y: this.absolutePosition().y,
        };
    },
});
stage.add(global.palette_layer);
var palette_width = global.palette_sorted.length * 50 + 40;
var max_drag_distance = (global.window_width > palette_width) ? 0 : palette_width - global.window_width;
global.palette_layer.on('dragmove', function () {
    global.palette_layer.y(global.palette_layer.absolutePosition().y);
    var x = global.palette_layer.x();
    if (x > 0)
        global.palette_layer.x(0);
    if (x < (max_drag_distance * -1))
        global.palette_layer.x(max_drag_distance * -1);
});
var bg = new Konva.Rect({
    width: palette_width,
    height: pallete_height,
    fill: '#f0f0f0',
});
global.palette_layer.add(bg);
function addPalleteCircle(x, y, colorObject) {
    var group = new Konva.Group({
        x: x,
        y: y,
        color: colorObject.color,
        completed: false,
        id: colorObject.color,
    });
    var circle = new Konva.Circle({
        radius: 20,
        fill: '#' + colorObject.color,
        qty: colorObject.qty,
        strokeWidth: 0,
        stroke: "#666",
        order: colorObject.order,
        name: 'palette-color'
    });
    var text = new Konva.Text({
        x: -20,
        y: -7,
        align: 'center',
        width: 40,
        text: colorObject.order + 1,
        fontSize: 14,
        fontFamily: 'Arial',
        fill: utils.getTextColor(colorObject.color),
    });
    group.on('click', triggerColorChange);
    group.on('tap', triggerColorChange);
    group.on('reset', resetActiveColor);
    group.add(circle);
    group.add(text);
    return group;
}
for (var i = 0; i < global.palette_sorted.length; i++) {
    var palette_color = addPalleteCircle(40 + i * 50, pallete_height / 2, global.palette_colors[global.palette_sorted[i]]);
    global.palette_layer.add(palette_color);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLmpzIiwic291cmNlUm9vdCI6Ii4uL3NyYy8iLCJzb3VyY2VzIjpbImFwcC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxRQUFRLENBQUMsZ0JBQWdCLENBQUMsWUFBWSxFQUFFLFVBQVMsQ0FBQztJQUNoRCxDQUFDLENBQUMsY0FBYyxFQUFFLENBQUM7QUFDbkIsQ0FBQyxFQUFDLEVBQUMsT0FBTyxFQUFFLEtBQUssRUFBQyxDQUFDLENBQUM7QUFHdEIsT0FBTyxLQUFLLE9BQU8sTUFBTSxXQUFXLENBQUE7QUFDcEMsT0FBTyxLQUFLLEtBQUssTUFBTSxTQUFTLENBQUE7QUFDaEMsT0FBTyxXQUFXLE1BQU0sZ0JBQWdCLENBQUM7QUFFekMsSUFBSSxLQUFLLEdBQUcsV0FBVyxDQUFDO0FBQ3hCLElBQUksWUFBWSxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUM7QUFDaEMsSUFBSSxXQUFXLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztBQU9sQyxJQUFJLE1BQU0sR0FBYztJQUN0QixZQUFZLEVBQUUsQ0FBQztJQUNmLGFBQWEsRUFBRSxDQUFDO0lBQ2hCLFlBQVksRUFBRSxRQUFRO0lBQ3RCLFdBQVcsRUFBRSxDQUFDO0lBQ2QsV0FBVyxFQUFFLEVBQUU7SUFDZixXQUFXLEVBQUUsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUM7SUFDekIsa0JBQWtCLEVBQUUsQ0FBQztJQUNyQixjQUFjLEVBQUUsRUFBRTtDQUNuQixDQUFBO0FBSUQsTUFBTSxDQUFDLFlBQVksR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDO0FBQ3hDLE1BQU0sQ0FBQyxhQUFhLEdBQUcsTUFBTSxDQUFDLFdBQVcsQ0FBQztBQUUxQyxNQUFNLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQywwQkFBMEIsQ0FBQztJQUNwRCxjQUFjLEVBQUUsTUFBTSxDQUFDLFlBQVk7SUFDbkMsZUFBZSxFQUFFLE1BQU0sQ0FBQyxhQUFhO0lB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